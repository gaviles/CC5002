<!DOCTYPE HTML>
<html>
<head>
	<meta charset="UTF-8">
	<title>DCC Express</title>
	<link rel="stylesheet" type="text/css" href="estilo.css">
	<script>
		aCountries = [
			{
				name:"Argentina",
				iso:"AR",
				cities:[{name:"Buenos Aires"},{name:"Córdoba"},{name:"Jujuy"},{name:"Mendoza"}]
			},
			{
				name:"Chile",
				iso:"CL",
				cities:[
					{name:"Antofagasta"},{name:"Concepción"},{name:"Copiapó"},{name:"La Serena"},
					{name:"Puerto Montt"},{name:"Santiago"}
				]
			},
			{
				name:"Perú",
				iso:"PE",
				cities:[{name:"Lima"},{name:"Cuzco"},{name:"Arequipa"},{name:"Trujillo"}]
			}
		];

		/*
		 * This funtion will add an option to the given selection type.
		 */

		function apendOption( oSelection, sValue, sCaption  ){

			// create the option object then set the value
			var oOption = document.createElement("option");
			oOption.setAttribute("value",sValue);
			// create the "caption" of teh object and then append it to the option object
			var oCaption = document.createTextNode( sCaption );
			oOption.appendChild(oCaption);
			oSelection.appendChild(oOption);
		}

		function setPaisOrigen( oCountrySelection ){

			removeSuggestion(oCountrySelection);
			var sPais = oCountrySelection.value;
			var oPaisOrigenSelection = document.getElementById('ciudad-origen');
			setCiudades( oPaisOrigenSelection, sPais );
		}

		function setPaisDestino( oCountrySelection ){

			removeSuggestion(oCountrySelection);
			var sPais = oCountrySelection.value;
			var oPaisDestinoSelection = document.getElementById('ciudad-destino');
			setCiudades( oPaisDestinoSelection, sPais );
		}

		function removeSuggestion( oSelect ){
			var oSuggestion = oSelect[0];
			if(oSuggestion.value == "" ){
				oSuggestion.remove();
			}

		}

		function setCiudades( oCiudadSelection, sPais ){

			for(var i= 0; i < aCountries.length ; i++){

				if(aCountries[i].name == sPais  ){
					// Reset the content of the given selection
					oCiudadSelection.innerHTML = "";
					apendOption( oCiudadSelection, "", "Seleccione una Ciudad" );
					for( var j=0 ; j < aCountries[i].cities.length ; j++ ){
						apendOption( oCiudadSelection, aCountries[i].cities[j].name, aCountries[i].cities[j].name );
					}
				}
			}
		}

		function ini(){
			// Insertar el arreglo de paises en el SELECT de paises
			var oPaisOrigenSelect = document.getElementById('pais-origen');
			var oPaisDestinoSelect = document.getElementById('pais-destino');
			for(var i= 0; i < aCountries.length ; i++){
				apendOption( oPaisOrigenSelect, aCountries[i].name, aCountries[i].name );
				apendOption( oPaisDestinoSelect, aCountries[i].name, aCountries[i].name );
			}
		}
		
		/*
		 * Esta funcion valida fechas, retornando false si la fecha es incorrecta u el objecto date si es correcta
		 */
		function testDate( sDate ){

			  /*
				 * verifica que la fecha pesea el formato correcto
			   * verifica que los primeros 4 caracteres deben ser números seguidos de un "-""
			   * luego deben haver entre 1 y 2 caracteres numericos, seguidos por un "-"
			   * finalmente debe terminar entre 1 y 2 caracteres también numericos
			   */
				var regexDate = /[0-9]{4}-[0-9]{1,2}-[0-9]{1,2}$/;

				if( !regexDate.test(sDate) ){
					return false;
				}

				// Divide the sDate sting in to an array using "-" divitions
				var aDate = sDate.split("-");

				console.log(aDate);

				// first check the length pf the array
				if( aDate.length !== 3 ){
			    console.log("mal largo");
					return false;
				}

			  // Parse the number to compare
			  aDate[0] = parseInt(aDate[0]);
			  aDate[1] = parseInt(aDate[1]);
			  aDate[2] = parseInt(aDate[2]);

				// Detetect if the date was weel write
				var oDate = new Date(aDate[0],(aDate[1]-1),aDate[2]);
			  console.log(oDate);

				// Detect if the year is correct
				if( oDate.getFullYear() != aDate[0] ){
			    console.log("mal año",oDate.getFullYear(),aDate[0])
					return false;
				}
				// Detect if the month is correct
				if( (oDate.getMonth()+1) != aDate[1] ){
			    console.log("mal mes",oDate.getMonth(),aDate[1])
					return false;
				}

				// Detect if the day is correct
				if( oDate.getDate() != aDate[2] ){
			    console.log("mala fecha",oDate.getDate(),aDate[2])
					return false;
				}

			  // La fecha es válida =]
				return oDate;
			}
		


		function validarFormulario(){
			console.log("validando formulario");

			// Validar Pais Origen
			var oPaisOrigen = document.getElementById('pais-origen');
			if( oPaisOrigen.value == "" ){
				alert("Por favor seleccione un País de origen");
				return false;
			}

			// Validar Ciudad de Origen
			var oCiudadOrigen = document.getElementById('ciudad-origen');
			if( oCiudadOrigen.value == "" ){
				alert("Por favor seleccione una Ciudad de origen");
				return false;
			}

			// Validar Pais de Destino
			var oPaisDestino = document.getElementById('pais-destino');
			if( oPaisDestino.value == "" ){
				alert("Por favor seleccione un País de destino");
				return false;
			}

			// Validar Ciudad de Destino
			var oCiudadDestino = document.getElementById('ciudad-destino');
			if( oCiudadDestino.value == "" ){
				alert("Por favor seleccione una Ciudad de destino");
				return false;
			}

			// Valida fechas de ida y regreso.
			var oIdaDate = testDate( document.getElementById('fecha-ida').value );
			if(oIdaDate == false){
				alert("Fecha de ida no es válida, Ej.:2012-08-20");
				return false;
			}

			var oRegresoDate = testDate( document.getElementById('fecha-regreso').value );
			if(oRegresoDate == false){
				alert("Fecha de regreso no es válida, Ej.:2012-08-20");
				return false;
			}

			if( oIdaDate >= oRegresoDate ){
				alert("La fecha de regreso debe ser mayor que la fecha de ida");
				return false;
			}
				
			alert("formulario valido!")
			return false;
		}

	</script>

</head>
<body onload="ini()">

	<div class="principal" >
		<h1>DCC Express!!!</h1>
		<br/>
		<div class="botones">
			<a class="boton" href="agregar-viaje.html" >Agregar Viaje</a>
			<a class="boton" href="agregar-encargo.html" >Agregar Encargo</a>
			<a class="boton" href="ver-viajes.html" >Ver Viajes</a>
			<a class="boton" href="ver-encargos.html" >Ver Encargos</a>
		</div>
		<br/>

		<form action="" method="POST" onsubmit="return validarFormulario()" >
		<table>
			<tr>
				<td>
					País de Origen:
				</td>
				<td>
					<select id="pais-origen" name="pais-origen" onchange="setPaisOrigen(this)" >
						<option value="" >Seleccione un País</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>
					Ciudad de Origen;
				</td>
				<td>
					<select id="ciudad-origen" name="ciudad-origen">
						<option value="buenos_aires" >Seleccione un País primero</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>
					País de Destino:
				</td>
				<td>
					<select id="pais-destino" name="pais-destino" onchange="setPaisDestino(this)">
						<option value="" >Seleccione un País</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>
					Ciudad de Destino:
				</td>
				<td>
					<select id="ciudad-destino" name="ciudad-destino">
						<option value="buenos_aires" >Seleccione un País primero</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>
					Fecha ida:
				</td>
				<td>
					<input type="text" id="fecha-ida" name="fecha-ida" value="año-mes-dia"  maxlength="10" />
				</td>
			</tr>
			<tr>
				<td>
					Fecha regreso:
				</td>
				<td>
					<input type="text" id="fecha-regreso" name="fecha-regreso" value="año-mes-dia" maxlength="10"  />
				</td>
			</tr>
			<tr>
				<td>
					Espacio Disponible:
				</td>
				<td>
					<select name="espacio-disponible">
						<option value="10x10x10" >10x10x10</option>
						<option value="20x20x20" >20x20x20</option>
						<option value="30x30x30" >30x30x30</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>
					Kilos Disponibles:
				</td>
				<td>				
					<select name="kilos-disponibles">
						<option value="200gr" >200 gr</option>
						<option value="500gr" >500 gr</option>
						<option value="800gr" >800 gr</option>
						<option value="1kg" >1 kg</option>
						<option value="1.5kg" >1.5 kg</option>
						<option value="2kg" >2 kg</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>
					Email del Viejero:
				</td>
				<td>
					<input type="text" name="email" size="30" />
				</td>
			</tr>
			<tr>
				<td>
					Número de Celular:
				</td>
				<td>
					<input type="text" name="celular" size="15" />
				</td>
			</tr>
			<tr>
				<td>
				</td>
				<td>
					<input type="submit" value="Enviar" />
				</td>
			</tr>
		</table>
		</form>
	</div>
</body>
</html>